<?php
 namespace Mgt\Varnish\Model\Observer; use Magento\Framework\Event\ObserverInterface; class ProductSaveAfterObserver implements ObserverInterface { protected $config; protected $productUrlRewriteGenerator; protected $catalogProductTypeConfigurable; protected $productFactory; protected $varnishConfig; protected $urlQueue; protected static $isQueued = false; public function __construct(\Magento\PageCache\Model\Config $config, \Magento\CatalogUrlRewrite\Model\ProductUrlRewriteGenerator $productUrlRewriteGenerator, \Magento\ConfigurableProduct\Model\ResourceModel\Product\Type\Configurable $catalogProductTypeConfigurable, \Magento\Catalog\Model\ProductFactory $productFactory, \Mgt\Varnish\Model\UrlQueue $urlQueue, \Mgt\Varnish\Model\Cache\Config $varnishConfig) { goto a6d13; bbb47: $this->varnishConfig = $varnishConfig; goto f8ddf; a6d13: $this->config = $config; goto Abc0c; Abc0c: $this->productUrlRewriteGenerator = $productUrlRewriteGenerator; goto Aee46; D80e5: $this->productFactory = $productFactory; goto Feec2; Feec2: $this->urlQueue = $urlQueue; goto bbb47; Aee46: $this->catalogProductTypeConfigurable = $catalogProductTypeConfigurable; goto D80e5; f8ddf: } public function execute(\Magento\Framework\Event\Observer $observer) { goto B7b4a; e9456: if (!(true === $isCacheWarmerEnabled && isset($product) && $product instanceof \Magento\Catalog\Model\Product)) { goto db9f2; } goto C088d; b1209: b9bd9: goto A6220; A6220: db9f2: goto Fdfb2; Df27c: $productId = $product->getId(); goto f520b; B7b4a: $product = $observer->getEvent()->getProduct(); goto d3c04; efe8b: A9c30: goto Ef97f; Ef7b1: $urls = []; goto B9c99; a6a21: if (!count($parentProductIds)) { goto c8a26; } goto Aeb18; Aeb18: foreach ($parentProductIds as $parentProductId) { goto E6381; bf55e: dbc1b: goto F76a9; c8012: fb54b: goto bf55e; E6381: $product = $this->productFactory->create(); goto E4d97; B87c1: $productUrls = $this->productUrlRewriteGenerator->generate($product); goto B55e0; E4d97: $product->load($parentProductId); goto B87c1; B55e0: foreach ($productUrls as $url) { $urls[] = ["\x73\164\x6f\x72\x65\137\151\144" => $url->getStoreId(), "\160\141\x74\150" => $url->getRequestPath(), "\160\x72\151\157\162\151\164\171" => \Mgt\Varnish\Model\UrlQueue::PRIORITY_HIGH]; c4837: } goto c8012; F76a9: } goto efe8b; Ef97f: c8a26: goto De3d7; C088d: $productUrls = $this->productUrlRewriteGenerator->generate($product); goto Ef7b1; dc018: a566b: goto B3a33; De3d7: goto d9802; goto f64a1; b0c46: try { $this->urlQueue->addToQueue($urls); } catch (\Exception $e) { } goto b1209; F7ec0: if (!count($urls)) { goto b9bd9; } goto b0c46; B3a33: d9802: goto F7ec0; d3c04: $isCacheWarmerEnabled = $this->varnishConfig->isCacheWarmerEnabled(); goto e9456; B9c99: if (false === empty($productUrls)) { goto c12db; } goto Df27c; d0081: foreach ($productUrls as $url) { $urls[] = ["\x73\164\x6f\x72\x65\x5f\x69\144" => $url->getStoreId(), "\160\141\x74\x68" => $url->getRequestPath(), "\160\162\151\x6f\x72\x69\164\x79" => \Mgt\Varnish\Model\UrlQueue::PRIORITY_HIGH]; Ede9a: } goto dc018; f64a1: c12db: goto d0081; f520b: $parentProductIds = $this->catalogProductTypeConfigurable->getParentIdsByChild($productId); goto a6a21; Fdfb2: } }
