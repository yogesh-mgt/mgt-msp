<?php
 namespace Mgt\Varnish\Model; use Laminas\Uri\Uri; class UrlQueue extends \Magento\Framework\Model\AbstractModel { const PRIORITY_HIGH = 1000; const PRIORITY_MEDIUM = 500; const PRIORITY_LOW = 100; protected $storeManager; protected $license; protected $licenseCache = []; public function __construct(\Magento\Framework\Model\Context $context, \Magento\Framework\Registry $registry, \Mgt\Varnish\Model\ResourceModel\UrlQueue $resource, \Magento\Store\Model\StoreManagerInterface $storeManager, \Mgt\Varnish\Model\License $license) { goto E9e60; d2f44: $this->storeManager = $storeManager; goto f9890; f9890: $this->license = $license; goto D2e87; E9e60: parent::__construct($context, $registry, $resource); goto d2f44; D2e87: } protected function _construct() { $this->_init("\x4d\x67\x74\x5c\126\141\162\x6e\x69\x73\x68\x5c\x4d\157\x64\145\154\134\x52\145\163\157\165\x72\143\145\115\157\144\145\154\x5c\x55\x72\154\121\165\x65\x75\145"); } public function getId() { return parent::getData("\165\x72\154\137\151\144"); } public function addToQueue(array $urls) { goto d437e; f06c8: if (!$urls) { goto a0bf4; } goto ea433; ea433: $resource = $this->_getResource(); goto e47d2; da767: a0bf4: goto D3a8b; d437e: $urls = $this->filterUrls($urls); goto f06c8; e47d2: $resource->addToQueue($urls); goto da767; D3a8b: } protected function filterUrls(array $urls) { goto e6f9e; eeea5: foreach ($urls as $url) { goto C6eb3; F8ae0: $filteredUrls[] = $url; goto E2406; Dade2: Dd011: goto D6428; C6eb3: $storeId = (int) $url["\163\x74\157\x72\145\137\151\144"]; goto A0096; ae611: $canAddUrlToQueue = $this->canAddUrlToQueue($storeId); goto b0ee6; E2406: A4860: goto Dade2; b0ee6: if (!(true === $canAddUrlToQueue)) { goto A4860; } goto F8ae0; A0096: $url["\160\x61\164\150"] = ltrim($url["\x70\x61\x74\x68"], "\x2f"); goto ae611; D6428: } goto F13c3; f6db1: return $filteredUrls; goto Ebb09; e6f9e: $filteredUrls = []; goto eeea5; F13c3: B1829: goto f6db1; Ebb09: } protected function canAddUrlToQueue($storeId) { goto F1dce; Fa5aa: f6c79: goto a7eb7; Bf3b5: return $canAddUrlToQueue; goto Fa5aa; D7c1b: $uri = new Uri($store->getBaseUrl()); goto A1946; e3ef1: goto f6c79; goto b3da6; Fe491: $canAddUrlToQueue = $this->licenseCache[$storeId]; goto Bf3b5; f45d8: return false; goto f0724; Afb92: c3b35: goto F31f7; F1dce: if (isset($this->licenseCache[$storeId])) { goto cdf49; } goto b1fd4; F31f7: return true; goto cb785; b3da6: cdf49: goto Fe491; Be96f: if (true === $hasLicense) { goto c3b35; } goto f45d8; f0724: goto Db9e2; goto Afb92; b1fd4: $store = $this->storeManager->getStore($storeId); goto D7c1b; A1946: $host = $uri->getHost(); goto A6b7b; A6b7b: $hasLicense = $this->license->hasLicense($host); goto A6b88; A6b88: $this->licenseCache[$storeId] = $hasLicense; goto Be96f; cb785: Db9e2: goto e3ef1; a7eb7: } }
