<?php
 namespace Mgt\Varnish\Model\Feed; use Magento\Framework\Config\ConfigOptionsListConstants; use Laminas\Http\Client as HttpClient; class Feed extends \Magento\Framework\Model\AbstractModel { const FEED_URL = "\x68\x74\x74\160\72\x2f\57\x66\145\145\x64\56\x6d\x67\x74\55\x63\x6f\155\x6d\145\x72\143\145\x2e\143\x6f\155\57"; const UPDATE_FREQUENCY = 21600; const SEVERITY_INFORMATION = 4; protected $backendConfig; protected $inboxFactory; protected $storeManager; protected $deploymentConfig; protected $productMetadata; protected $urlBuilder; public function __construct(\Magento\Framework\Model\Context $context, \Magento\Framework\Registry $registry, \Magento\Backend\App\ConfigInterface $backendConfig, \Magento\AdminNotification\Model\InboxFactory $inboxFactory, \Magento\Store\Model\StoreManagerInterface $storeManager, \Magento\Framework\App\DeploymentConfig $deploymentConfig, \Magento\Framework\App\ProductMetadataInterface $productMetadata, \Magento\Framework\UrlInterface $urlBuilder, ?\Magento\Framework\Model\ResourceModel\AbstractResource $resource = null, ?\Magento\Framework\Data\Collection\AbstractDb $resourceCollection = null, array $data = []) { goto Ba913; c15fb: $this->inboxFactory = $inboxFactory; goto A0308; Ba913: parent::__construct($context, $registry, $resource, $resourceCollection, $data); goto c6ffc; D89a2: $this->deploymentConfig = $deploymentConfig; goto f484d; d65c7: $this->urlBuilder = $urlBuilder; goto a5663; c6ffc: $this->backendConfig = $backendConfig; goto c15fb; A0308: $this->storeManager = $storeManager; goto D89a2; f484d: $this->productMetadata = $productMetadata; goto d65c7; a5663: } protected function _construct() { } public function checkUpdate() { goto C2a94; e7bc8: E559b: goto Efa16; Efa16: $this->setLastUpdate(); goto B15b4; d2dbf: return $this; goto be678; B15b4: return $this; goto Eab75; D0874: $installDate = strtotime($this->deploymentConfig->get(ConfigOptionsListConstants::CONFIG_PATH_INSTALL_DATE)); goto d03d4; D7337: $feedData = []; goto ab115; Bf9ea: c3a35: goto e7bc8; f5eae: $lastUpdate = $this->getLastUpdate(); goto ad0f5; ab115: $feedXml = $this->getFeedData(); goto D0874; D25e0: if (!$feedData) { goto c3a35; } goto A42f6; A42f6: $this->inboxFactory->create()->parse(array_reverse($feedData)); goto Bf9ea; ad0f5: if (!($frequency + $lastUpdate > time())) { goto Ca58a; } goto d2dbf; be678: Ca58a: goto D7337; E4e3e: e0a0d: goto D25e0; d03d4: if (!($feedXml && isset($feedXml->channel) && isset($feedXml->channel->item))) { goto E559b; } goto d8121; d8121: foreach ($feedXml->channel->item as $item) { goto F281e; c70f9: if (!($installDate <= $itemPublicationDate)) { goto Add5f; } goto ffe1b; d1ec6: Fa073: goto a20ff; ffe1b: $feedData[] = ["\163\x65\x76\145\x72\151\x74\171" => self::SEVERITY_INFORMATION, "\x64\x61\164\x65\137\x61\x64\x64\x65\x64" => date("\131\55\155\x2d\x64\40\110\x3a\151\x3a\163", $itemPublicationDate), "\164\x69\x74\x6c\145" => (string) $item->title, "\144\145\x73\143\x72\151\x70\x74\x69\x6f\x6e" => (string) $item->description, "\x75\162\x6c" => (string) $item->link]; goto E596c; E596c: Add5f: goto d1ec6; F281e: $itemPublicationDate = strtotime((string) $item->pubDate); goto c70f9; a20ff: } goto E4e3e; C2a94: $frequency = $this->getFrequency(); goto f5eae; Eab75: } public function getFrequency() { return self::UPDATE_FREQUENCY; } public function getLastUpdate() { return $this->_cacheManager->load("\155\147\x74\x5f\146\x65\x65\x64\x5f\x61\x64\155\x69\x6e\137\156\157\164\151\146\x69\x63\141\164\x69\157\x6e\163\x5f\154\141\x73\x74\x63\x68\145\143\x6b"); } public function setLastUpdate() { $this->_cacheManager->save(time(), "\155\x67\164\x5f\146\x65\145\144\x5f\141\144\x6d\151\156\137\x6e\x6f\x74\x69\146\151\x63\x61\164\x69\157\156\x73\137\x6c\141\x73\164\x63\x68\x65\143\x6b"); return $this; } public function getFeedData() { try { goto Fdf59; D7e90: $httpClient->setParameterPost($postParams); goto Ab074; Bd3cd: $postParams = ["\x73\150\157\x70\137\165\162\x6c" => $this->storeManager->getStore()->getBaseUrl(), "\166\x65\162\163\151\157\156" => $this->productMetadata->getVersion()]; goto F7739; Fdf59: $xml = ''; goto Bd3cd; F7739: $config = ["\141\x64\141\x70\164\145\x72" => HttpClient\Adapter\Curl::class, "\143\x75\162\154\157\160\x74\151\157\156\163" => [CURLOPT_FOLLOWLOCATION => true], "\155\x61\x78\162\x65\144\x69\162\145\143\x74\163" => 0, "\x74\151\x6d\145\157\x75\164" => 30]; goto E1fe6; A6888: $httpClient->setMethod("\120\x4f\123\124"); goto D7e90; Ba122: if (!(200 == $response->getStatusCode())) { goto Cb604; } goto D2b66; f256e: Cb604: goto A2da1; D2b66: $xml = new \SimpleXMLElement($response->getBody()); goto f256e; E1fe6: $httpClient = new HttpClient(self::FEED_URL, $config); goto A6888; Ab074: $response = $httpClient->send(); goto Ba122; A2da1: } catch (\Exception $e) { return false; } return $xml; } }
