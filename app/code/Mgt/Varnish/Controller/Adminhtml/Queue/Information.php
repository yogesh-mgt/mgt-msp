<?php
 namespace Mgt\Varnish\Controller\Adminhtml\Queue; class Information extends \Magento\Backend\App\Action { const SQL_LIMIT_URL_QUEUE = 500; protected $jsonHelper; protected $storeManager; protected $urlQueueCollection; public function __construct(\Magento\Backend\App\Action\Context $context, \Magento\Framework\Json\Helper\Data $jsonHelper, \Magento\Store\Model\StoreManagerInterface $storeManager, \Mgt\Varnish\Model\ResourceModel\UrlQueue\Collection $urlQueueCollection) { goto Dd7bb; Dd7bb: parent::__construct($context); goto b65b9; b65b9: $this->jsonHelper = $jsonHelper; goto eb4e6; A42e7: $this->storeManager = $storeManager; goto ffc03; eb4e6: $this->urlQueueCollection = $urlQueueCollection; goto A42e7; ffc03: } public function execute() { goto fde2b; Ee1d3: $data = ["\156\165\x6d\142\145\x72\117\146\125\x72\154\x73" => $numberOfUrls, "\x63\157\156\x74\145\156\164" => implode("\x3c\x62\x72\76", $urlsInQueue)]; goto be509; be509: $response = $this->getResponse(); goto b9c30; F609f: return $response; goto Ec39c; A9bfc: $urlsInQueue = $this->getUrlsFromQueue(); goto Ee1d3; fde2b: $numberOfUrls = $this->urlQueueCollection->getSize(); goto A9bfc; b9c30: $response->representJson($this->jsonHelper->jsonEncode($data)); goto F609f; Ec39c: } public function getUrlsFromQueue() { goto ab25c; ab25c: $urls = []; goto Fe2c0; Fa50b: foreach ($this->urlQueueCollection as $url) { goto B7923; B7923: $storeId = $url->getStoreId(); goto aa4b2; Dc69c: f4709: goto Cc6bb; C02fc: $urls[] = $url; goto Dc69c; b426f: $url = sprintf("\45\163\57\45\163", rtrim($store->getBaseUrl(), "\57"), ltrim($url->getPath(), "\x2f")); goto C02fc; aa4b2: $store = $this->storeManager->getStore($storeId); goto b426f; Cc6bb: } goto Bb25a; Fe2c0: $this->urlQueueCollection->addOrder("\160\x72\151\157\162\x69\164\171"); goto b9df2; f4423: $this->urlQueueCollection->load(); goto Fa50b; b9df2: $this->urlQueueCollection->setPageSize(self::SQL_LIMIT_URL_QUEUE); goto f4423; Bb25a: E62fa: goto ec481; ec481: return $urls; goto a7030; a7030: } }
